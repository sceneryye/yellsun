var pageProductEffect=function(){var a=$('[data-getDetail="more"]'),b=$('[data-mersale="true"]'),c=$("#goods_images li"),d=$(".bottomdiv"),e={init:function(){var a=$(this),b={elem:a,pid:a.prev().find('input[name="product_id"]').length?parseInt(a.prev().find('input[name="product_id"]').val()):null,child:a.next().children().filter(".loading"),check:a.data("merchandise").toString(),type:null};b.type=""!=b.check&&"string"==typeof b.check&&"normal"==b.check?!0:!1,!isNaN(b.pid)&&null!=b.pid&&(b.elem.hide(),b.child.show(),e.detail(b))},detail:function(a){if(a.type)var b={url:"ajaxapi-getproductdetail.html?"+(new Date).getTime(),data:{productid:a.pid},type:"GET"};else var b={url:"ajaxapi-getbeautydetail.html?"+(new Date).getTime(),data:{productid:a.pid},type:"GET"};b.error=function(){a.child.fadeOut(function(){hawk.blackDialog("网络延时，请刷新页面重试！")})},b.success=function(b){b&&null!=b&&void 0!=b?b.length>0&&""!=b&&null!=b&&a.child.fadeOut(function(){$(this).prev().css({style:"display:none"}).html(b).fadeIn()}):(a.elem.fadeIn(),a.child.fadeOut(function(){hawk.blackDialog("网络延时，请刷新页面重试！")}))},$.ajax(b)}},f={sizeDefault:function(){var a=saveProValue(),b={product_id:parseInt(a.product_id),brand_id:parseInt(a.brand_id),userUrl:"ajaxapi-productsizes.html?"};return{wapDom:b}},init:function(){var a=$(this),b={elem:a,clsName:a.attr("class"),size:parseInt(a.data("size"),10),input:a.parent().next().filter('input[name="size"]'),pars:a.parent(),parent:a.parent().parent(),index:a.parent().children().index(this),top:a.position().top+parseInt(a.css("marginTop"))-60,left:a.position().left+(a.innerWidth()/2-15),getsize:a.parent().data("mersale")};"choose"==b.clsName&&b.elem.addClass("select").siblings("li").filter(".choose").removeClass("select").parent().next().filter('input[name="size"]').val(b.size),b.getsize&&(void 0==b.pars.data("saveData")?f.getSize(b):f.saveSize(b.pars.data("saveData"),b))},getSize:function(a){var b=f.sizeDefault();$.ajax({url:b.wapDom.userUrl+"s="+(new Date).getTime(),data:{act:b.wapDom.act,productid:b.wapDom.product_id,brandid:b.wapDom.brand_id},dataType:"json",success:function(b){f.saveSize(b,a),a.pars.data("saveData",b)}})},saveSize:function(a,b){$.each(a,function(c){var d=a[c],e=b.parent;if(d.content.length>0&&"array"==d.type){e.find(".J_wrap_tableBox").html()&&e.find(".J_wrap_tableBox").remove();var f=Math.ceil(99999*Math.random());e.append('<div class="J_wrap_tableBox" id="J_wrap_table'+f+'"></div>'),$("#J_wrap_table"+f).css({opacity:0}).prepend('<div class="J_wrap_tableInfo"><a class="J_close">x</a><div class="J_arrow"></div><table class="J_wrap_sizeTable hidden" border="0" cellspacing="0" cellpadding="0" width="100%" bordercolor="#CCCACC" id="J_wrap_sizeTemplate"><tbody id="J_tableBody"></tbody></table></div>'),$("#J_wrap_table"+f).children().find("table").removeClass("hidden"),$_tableHtml="",$_tableHtml+="<tr>",$.each(d.content[0],function(a,b){$_tableHtml+=""==b?"<th>/</th>":"<th>"+b+"</th>"}),$_tableHtml+="</tr>",$_tableHtml+="<tr>",$.each(d.content[b.index+1],function(a,b){$_tableHtml+=""==b?"<td>/</td>":"<td>"+b+"</td>"}),$_tableHtml+="</tr>",$("#J_wrap_table"+f).children().find("table").children("#J_tableBody").prepend($_tableHtml),$("#J_wrap_table"+f).children().children(".J_arrow").css({left:b.left}),$("#J_wrap_table"+f).css({top:b.top}).fadeTo(500,.85)}}),$(".J_close").on("click.closeJprosize",function(){$(this).parents(".J_wrap_tableBox").dequeue().fadeOut("fast",function(){$(this).remove()})})}},g={init:function(){var a=$(this),b=$("#Photo-modal"),d={elem:a,index:c.index(this),top:$(document).scrollTop(),model:b.attr("id"),imgList:$("img.Touch_mer_biglImg"),point:b.find("#Photo-pagination").children().filter("em")};g.open(d)},open:function(a){hawk.showDialog({modal:"#"+a.model,setClass:"ui-modal-center",overClose:!1,width:320,isCenter:!1,top:0,closeBtn:!1,modalHide:!0,overOpacity:.9}),window.bigImgReview=new Swipe(document.getElementById("Photo-slide"),{startSlide:a.index,callback:function(b,c){index=c,a.imgList.eq(index).hasClass("active")||hawk.loadcheck(a.imgList.eq(index),{oncomplete:function(a,b,c){this.width==this.height&&1==this.width||this.width==this.height&&0==this.width?a.attr("src",c).fadeIn(1e3).addClass("active"):a.attr("src",b).fadeIn(1e3).addClass("active")}}),a.point.filter(":eq("+index+")").addClass("on").siblings().removeClass("on")}}),a.imgList.each(function(){hawk.loadcheck(a.imgList.eq(a.index),{oncomplete:function(a,b,c){this.width==this.height&&1==this.width||this.width==this.height&&0==this.width?a.attr("src",c).fadeIn(1e3).addClass("active"):a.attr("src",b).fadeIn(1e3).addClass("active")}}),$(this).bind("error",function(){var b=a.imgList.index(this);g.checkNote.call($(this),b,a.point,window.bigImgReview)})}),a.point.filter(":eq("+a.index+")").addClass("on").siblings().removeClass("on")},slide:function(){var a={obj:document.getElementById("goods_images"),imgList:$("img.smallImg"),point:$("#pro_pagination").children().filter("em"),index:0},b=new Swipe(a.obj,{Distance:62,callback:function(b,c){var d=c+1;a.imgList.eq(d).length&&!a.imgList.eq(d).hasClass("active")&&hawk.loadcheck(a.imgList.eq(d),{oncomplete:function(a,b,c){this.width==this.height&&1==this.width||this.width==this.height&&0==this.width?a.hide().attr("src",c).fadeIn(1e3).addClass("active"):a.hide().attr("src",b).fadeIn(1e3).addClass("active")}}),a.point.eq(c).addClass("on").siblings().removeClass("on")}});a.point.eq(a.index).addClass("on").siblings().removeClass("on"),hawk.loadcheck(a.imgList.eq(a.index),{oncomplete:function(a,b,c){this.width==this.height&&1==this.width||this.width==this.height&&0==this.width?a.attr("src",c).fadeIn().addClass("active"):a.attr("src",b).fadeIn().addClass("active")}}),hawk.loadcheck(a.imgList.eq(a.index+1),{oncomplete:function(a,b,c){this.width==this.height&&1==this.width||this.width==this.height&&0==this.width?a.attr("src",c).fadeIn().addClass("active"):a.attr("src",b).fadeIn().addClass("active")}}),a.imgList.each(function(){$(this).bind("error",function(){var c=a.imgList.index(this);g.checkNote.call($(this),c,a.point,b)})})},checkNote:function(a,b,c){this.parent().remove(),b.eq(a).remove(),c.setup()}},h={init:function(){var a=$(this),b={elem:a,shopcart:a.prev(),obj:$("[data-mersale]").parent(),jump:a.data("addjump"),anItem:a.data("animate"),product_id:$('input[name="product_id"]').val(),size:$('input[name="size"]').length?$('input[name="size"]').val():"",num:$('input[name="num"]').val(),channel_id:$('input[name="channel_id"]').val(),cat_id:$('input[name="cat_id"]').val(),warehouse:$('input[name="warehouse"]').val(),product_name:$('input[name="product_name"]').val(),small_image:$('input[name="small_image"]').val(),vipshop_price:$('input[name="vipshop_price"]').val(),market_price:$('input[name="market_price"]').val(),agio:$('input[name="agio"]').val(),back_url:encodeURIComponent(location.href)};h.add(b)},loginInit:function(){var a=$('[data-addcart="true"]'),b={elem:a,shopcart:a.prev(),obj:$("[data-mersale]").parent(),jump:a.data("addjump"),anItem:a.data("animate"),product_id:$('input[name="product_id"]').val(),size:a.data("size"),num:a.data("num"),channel_id:$('input[name="channel_id"]').val(),cat_id:$('input[name="cat_id"]').val(),warehouse:$('input[name="warehouse"]').val(),product_name:$('input[name="product_name"]').val(),small_image:$('input[name="small_image"]').val(),vipshop_price:$('input[name="vipshop_price"]').val(),market_price:$('input[name="market_price"]').val(),agio:$('input[name="agio"]').val(),back_url:encodeURIComponent(location.href)};h.add(b)},add:function(a){var b=hawk.validate.empty(a.size),c=hawk.validate.empty(a.product_id),d=hawk.validate.empty(a.num);if(!c)return hawk.redDialog("无法加入购物车：未知异常"),!1;if(!b)return hawk.redDialog("无法加入购物车：请先选择尺码"),hawk.flicker(a.obj,"ui-note-error",!0,0,5,130),!1;if(!d||a.num>1||a.num<=0)return hawk.redDialog("无法加入购物车：请勿修改数量"),!1;if(1==a.jump){a.elem.html(""),$("<div />",{"class":"lmask"}).html('<img src="view/touch/images/common/loading-big.gif" style="width:20px;margin-right:10px;" /> 加入中...').appendTo(a.elem.parent());var e={url:"index.php?",data:{m:"flow",act:"addtocart",channel_id:a.channel_id,product_id:a.product_id,size:a.size,num:a.num,cat_id:a.cat_id,warehouse:a.warehouse,product_name:a.product_name,small_image:a.small_image,vipshop_price:a.vipshop_price,market_price:a.market_price,agio:a.agio,back_url:a.back_url},dataType:"json",type:"GET"};e.error=function(){a.elem.html("加入购物车").next().remove(),hawk.redDialog("网络延时，请刷新页面重试！")},e.success=function(b){if(a.elem.html("加入购物车").next().remove(),0==b.code&&b.add_num>0){var c={elem:$('[data-cTime="true"]'),startTime:b.clear_time,timeStamp:{day:"",hour:"",min:":",sec:""},action:"remain",callback:!0,callbackFunction:function(){this.add(this.prev().prev()).fadeOut(function(){$(this).html("").prev().prev().html("")})},onDoCallback:!0,onDoComplete:function(a,b){b.complete(!0)}},d=void 0!=$('[data-cartimg="img"]').children("li:eq(0)").find("[data-original]").data("original")?$('[data-cartimg="img"]').children("li:eq(0)").find("[data-original]").data("original"):$('[data-cartimg="img"]').children("li:eq(0)").find("img").attr("src");animateDom={elem:a.elem.prev().children(".carticon"),mode:1,width:100,imgSrc:$("<img />",{src:""+d}),animateSpeed:1e3,endCallback:function(a){a.fadeOut(function(){$(this).remove()})}},a.shopcart.children(".num_cart").html(b.count).fadeIn("slow"),a.shopcart.children(".num_cunt").fadeIn("slow"),hawk.countDown(c),hawk.animate(animateDom),$("#om_act_url").attr("src",b.om_act_url)}else if(111==b.code&&b.url.length>1)location.href=b.url;else if(112==b.code)hawk.showDialog(b.msg,{title:"唯品会提醒您",setClass:"ui-modal-btn-c",overClose:!1,buttons:!0,type:"defined",onCloseCallBack:!0,buttonsCus:[{name:"切换站点",attribute:!1}],buttonsPos:1,buttonsStyle:"btn-purple",onDoComplete:function(a,b){b.oncomplete(!1),hawk.Set("WAP[p_wh]","","","","/"),self.location.href="index.html"}});else if(b.code>0&&b.msg.length>1)return hawk.redDialog(b.msg),!1},$.ajax(e)}},cartTime:function(){var a=$('[data-cTime="true"]'),b={elem:a,startTime:parseInt(a.attr("data-cartTime")),timeStamp:{day:"",hour:"",min:":",sec:""},action:"remain",callback:!0,callbackFunction:function(){this.add(this.prev().prev()).fadeOut(function(){$(this).html("").prev().prev().html("")})}};!isNaN(b.startTime)&&b.startTime>0&&hawk.countDown(b)},saleTime:function(){var a={elem:$('[data-saleProduct="true"]'),container:"span.J-time",startTime:$('[data-saleProduct="true"]').attr("data-saletime"),milliSec:!0,interval:100,unitFormat:{day:!0,hour:!0,min:!0,sec:!0,msec:!0},timeStamp:{day:"天",hour:"时",min:"分",sec:".",msec:"秒"},halfwayTime:!1};hawk.countDown(a)}},i={set:function(){c.length&&g.slide()},login:function(){var a=$('[data-addcart="true"]');a.length&&a.data("loginaddcart")&&h.loginInit()}},j={events:function(){a.off("click.detail.loading").on("click.detail.loading",e.init),b.off("click.choice.size","li").on("click.choice.size","li",f.init),c.off("click.show.photo").on("click.show.photo",g.init),d.off("click.add.cart",'[data-addcart="true"]').on("click.add.cart",'[data-addcart="true"]',h.init)}},k={init:function(){j.events(),h.cartTime(),h.saleTime(),i.set(),i.login(),hawk.download()}};return{init:k.init}}();$(function(){pageProductEffect.init()});